{
  "$schema": "https://vega.github.io/schema/vega-lite/v3.json",
  "data": {
    "url": "./gh-specs/data/334.vl.json"
  },
  "description": "House majority over time",
  "config": {
    "style": {
      "cell": {
        "stroke": "transparent"
      }
    }
  },
  "resolve": {
    "scale": {
      "color": "independent",
      "opacity": "independent"
    }
  },
  "hconcat": [
    {
      "vconcat": [
        {
          "height": 150,
          "width": 500,
          "layer": [
            {
              "transform": [
                {
                  "filter": {
                    "field": "District",
                    "valid": true
                  }
                },
                {
                  "window": [
                    {
                      "op": "count",
                      "field": "*",
                      "as": "n_party_year"
                    }
                  ],
                  "groupby": [
                    "session_year",
                    "party"
                  ],
                  "frame": [
                    null,
                    null
                  ]
                },
                {
                  "window": [
                    {
                      "op": "count",
                      "field": "*",
                      "as": "n_year"
                    }
                  ],
                  "groupby": [
                    "session_year"
                  ],
                  "frame": [
                    null,
                    null
                  ]
                },
                {
                  "calculate": "datum.n_party_year/datum.n_year - 0.5",
                  "as": "prop"
                },
                {
                  "calculate": "datum.prop < 0 ? 'R' : 'D'",
                  "as": "majority_party"
                },
                {
                  "calculate": "abs(datum.prop)",
                  "as": "abs_prop"
                },
                {
                  "filter": {
                    "field": "party",
                    "equal": "D"
                  }
                }
              ],
              "mark": "bar",
              "encoding": {
                "x": {
                  "field": "session_year",
                  "type": "quantitative",
                  "axis": {
                    "format": "-d",
                    "title": "",
                    "values": [
                      1940,
                      1950,
                      1960,
                      1970,
                      1980,
                      1990,
                      2000,
                      2010,
                      2020
                    ]
                  }
                },
                "y": {
                  "aggregate": "mean",
                  "field": "abs_prop",
                  "type": "quantitative",
                  "axis": {
                    "title": "Majority party lead",
                    "format": "p"
                  }
                },
                "color": {
                  "field": "majority_party",
                  "type": "ordinal",
                  "legend": null,
                  "scale": {
                    "domain": [
                      "D",
                      "I",
                      "R",
                      "Vacant",
                      "Mixed"
                    ],
                    "range": [
                      "#377EB8",
                      "#FFD92F",
                      "#E41A1C",
                      "#CCCCCC",
                      "#B279A2"
                    ]
                  }
                }
              }
            },
            {
              "selection": {
                "brush": {
                  "type": "single",
                  "on": "mousemove",
                  "encodings": [
                    "x"
                  ],
                  "nearest": true,
                  "resolve": "global",
                  "empty": "none"
                }
              },
              "mark": {
                "type": "point"
              },
              "encoding": {
                "opacity": {
                  "value": 0
                },
                "x": {
                  "field": "session_year",
                  "type": "quantitative",
                  "axis": {
                    "format": "-d",
                    "title": "",
                    "values": [
                      1940,
                      1950,
                      1960,
                      1970,
                      1980,
                      1990,
                      2000,
                      2010,
                      2020
                    ]
                  }
                }
              }
            },
            {
              "transform": [
                {
                  "filter": {
                    "and": [
                      "brush.session_year",
                      {
                        "selection": "brush"
                      }
                    ]
                  }
                }
              ],
              "mark": "rule",
              "encoding": {
                "x": {
                  "field": "session_year",
                  "type": "quantitative",
                  "axis": {
                    "format": "-d",
                    "title": "",
                    "values": [
                      1940,
                      1950,
                      1960,
                      1970,
                      1980,
                      1990,
                      2000,
                      2010,
                      2020
                    ]
                  }
                }
              }
            }
          ]
        },
        {
          "height": 150,
          "width": 500,
          "layer": [
            {
              "transform": [
                {
                  "filter": {
                    "field": "District",
                    "valid": true
                  }
                },
                {
                  "window": [
                    {
                      "op": "count",
                      "field": "*",
                      "as": "n_party_gender_year"
                    }
                  ],
                  "groupby": [
                    "session_year",
                    "Gender",
                    "party"
                  ],
                  "frame": [
                    null,
                    null
                  ]
                },
                {
                  "window": [
                    {
                      "op": "count",
                      "field": "*",
                      "as": "n_party_year"
                    }
                  ],
                  "groupby": [
                    "session_year",
                    "party"
                  ],
                  "frame": [
                    null,
                    null
                  ]
                },
                {
                  "calculate": "datum.n_party_gender_year/datum.n_party_year",
                  "as": "prop"
                },
                {
                  "filter": {
                    "field": "Gender",
                    "equal": "Female"
                  }
                },
                {
                  "filter": {
                    "field": "party",
                    "oneOf": [
                      "D",
                      "R"
                    ]
                  }
                }
              ],
              "mark": "line",
              "encoding": {
                "x": {
                  "field": "session_year",
                  "type": "quantitative",
                  "axis": {
                    "format": "-d",
                    "title": "",
                    "values": [
                      1940,
                      1950,
                      1960,
                      1970,
                      1980,
                      1990,
                      2000,
                      2010,
                      2020
                    ]
                  }
                },
                "y": {
                  "field": "prop",
                  "type": "quantitative",
                  "scale": {
                    "domain": [
                      0,
                      0.6
                    ]
                  },
                  "axis": {
                    "format": "p",
                    "title": "% Female"
                  }
                },
                "color": {
                  "field": "party",
                  "type": "ordinal",
                  "legend": null,
                  "scale": {
                    "domain": [
                      "D",
                      "I",
                      "R",
                      "Vacant",
                      "Mixed"
                    ],
                    "range": [
                      "#377EB8",
                      "#FFD92F",
                      "#E41A1C",
                      "#CCCCCC",
                      "#B279A2"
                    ]
                  }
                },
                "opacity": {
                  "value": 0.25
                }
              }
            },
            {
              "transform": [
                {
                  "filter": {
                    "field": "District",
                    "valid": true
                  }
                },
                {
                  "window": [
                    {
                      "op": "count",
                      "field": "*",
                      "as": "n_gender_year"
                    }
                  ],
                  "groupby": [
                    "session_year",
                    "Gender"
                  ],
                  "frame": [
                    null,
                    null
                  ]
                },
                {
                  "window": [
                    {
                      "op": "count",
                      "field": "*",
                      "as": "n_year"
                    }
                  ],
                  "groupby": [
                    "session_year"
                  ],
                  "frame": [
                    null,
                    null
                  ]
                },
                {
                  "calculate": "datum.n_gender_year/datum.n_year",
                  "as": "prop"
                },
                {
                  "filter": {
                    "field": "Gender",
                    "equal": "Female"
                  }
                }
              ],
              "encoding": {
                "x": {
                  "field": "session_year",
                  "type": "quantitative"
                },
                "y": {
                  "field": "prop",
                  "type": "quantitative",
                  "axis": {
                    "format": "p",
                    "title": "% Female"
                  }
                },
                "color": {
                  "value": "black"
                }
              },
              "layer": [
                {
                  "mark": "line"
                },
                {
                  "data": {
                    "values": [
                      {
                        "xval": 1939,
                        "yval": 0.05,
                        "label": "Overall"
                      }
                    ]
                  },
                  "mark": "text",
                  "encoding": {
                    "text": {
                      "field": "label",
                      "type": "nominal"
                    },
                    "x": {
                      "field": "xval",
                      "type": "quantitative"
                    },
                    "y": {
                      "field": "yval",
                      "type": "quantitative"
                    }
                  }
                }
              ]
            },
            {
              "selection": {
                "brush": {
                  "type": "single",
                  "on": "mousemove",
                  "encodings": [
                    "x"
                  ],
                  "nearest": true,
                  "resolve": "global",
                  "empty": "none"
                }
              },
              "mark": {
                "type": "point"
              },
              "encoding": {
                "opacity": {
                  "value": 0
                },
                "x": {
                  "field": "session_year",
                  "type": "quantitative",
                  "axis": {
                    "format": "-d",
                    "title": "",
                    "values": [
                      1940,
                      1950,
                      1960,
                      1970,
                      1980,
                      1990,
                      2000,
                      2010,
                      2020
                    ]
                  }
                }
              }
            },
            {
              "transform": [
                {
                  "filter": {
                    "and": [
                      "brush.session_year",
                      {
                        "selection": "brush"
                      }
                    ]
                  }
                }
              ],
              "mark": "rule",
              "encoding": {
                "x": {
                  "field": "session_year",
                  "type": "quantitative",
                  "axis": {
                    "format": "-d",
                    "title": "",
                    "values": [
                      1940,
                      1950,
                      1960,
                      1970,
                      1980,
                      1990,
                      2000,
                      2010,
                      2020
                    ]
                  }
                }
              }
            }
          ]
        }
      ]
    },
    {
      "width": 500,
      "height": 290,
      "encoding": {
        "x": {
          "field": "x",
          "type": "quantitative",
          "scale": {
            "domain": [
              0.6,
              10.75
            ],
            "nice": false
          },
          "axis": null
        },
        "y": {
          "field": "y",
          "type": "quantitative",
          "scale": {
            "domain": [
              0.6,
              6.5
            ],
            "nice": false
          },
          "axis": null
        }
      },
      "layer": [
        {
          "mark": {
            "type": "square",
            "size": 1700,
            "strokeWidth": 1
          },
          "encoding": {
            "stroke": {
              "value": "#eeeeee"
            }
          }
        },
        {
          "transform": [
            {
              "filter": {
                "selection": "brush"
              }
            }
          ],
          "mark": {
            "type": "square",
            "size": 1700
          },
          "encoding": {
            "color": {
              "field": "party",
              "type": "ordinal",
              "scale": {
                "domain": [
                  "D",
                  "I",
                  "R",
                  "Vacant",
                  "Mixed"
                ],
                "range": [
                  "#377EB8",
                  "#FFD92F",
                  "#E41A1C",
                  "#CCCCCC",
                  "#B279A2"
                ]
              },
              "legend": {
                "orient": "top",
                "direction": "horizontal"
              }
            },
            "opacity": {
              "field": "Gender",
              "type": "ordinal",
              "scale": {
                "domain": [
                  "Male",
                  "",
                  "Female"
                ],
                "range": [
                  1,
                  0.25
                ]
              },
              "legend": {
                "orient": "top",
                "direction": "horizontal",
                "values": [
                  "Male",
                  "Female"
                ]
              }
            },
            "tooltip": [
              {
                "field": "Legislator",
                "type": "nominal"
              },
              {
                "field": "District",
                "type": "nominal"
              },
              {
                "field": "Party",
                "type": "nominal"
              },
              {
                "field": "Gender",
                "type": "nominal"
              }
            ]
          }
        }
      ]
    }
  ],
  "spacing": 50,
  "center": true
}